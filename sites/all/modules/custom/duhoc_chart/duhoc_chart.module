<?php

/**
 * implement hook_init
 */

function duhoc_chart_init() {
  drupal_add_js(drupal_get_path('module','duhoc_chart').'/misc/jsapi');
}

/**
 * implement hook block_info
 */

function duhoc_chart_block_info() {
  $blocks['chart_colum_home'] = array(
    'info' => t('Chart colum home'),
  );

  return $blocks;
}

/**
 * implement hook_block_view
 */

function duhoc_chart_block_view($delta = '') {
  $block = array();
  switch ($delta) {
    case 'chart_colum_home':
      $block['content'] = duhoc_chart_colum();
      break;
  }
  return $block;
}

function duhoc_chart_colum() {
  $timenow = time();
  $ynow = date('Y',$timenow);
  $mnow = date('m',$timenow);

  $js = '
      google.load("visualization", "1", {packages:["corechart"]});
google.setOnLoadCallback(drawChart);
function drawChart() {

  var data = google.visualization.arrayToDataTable([
    ["Tháng", "Năm Nay", "Năm trước"],
    ["T.8",  1000,      400],
    ["T.9",  1170,      460],
    ["T.10",  660,       1120],
    ["T.11",  1030,      540]
  ]);

  var options = {
    title: "Chart study",
    hAxis: {title: "Tháng", titleTextStyle: {color: "red"}}
  };

  var chart = new google.visualization.ColumnChart(document.getElementById("chart_div"));

  chart.draw(data, options);

}

  ';

  drupal_add_js($js, array('scope' => 'footer', 'type' => 'inline'));
  $output = '<div class="content_home"> <div id="chart_div" style="width: 900px; height: 500px;"></div>';
  $output .= '</div>';
  return $output;
}

function duhoc_chart_time_now($t) {
  global $user;
  $query  = db_query("SELCT taget.field_target_value FROM field_data_field_target taget INNER JOIN field_data_field_th_ng moth ON taget.entity_id = moth.entity_id WHERE  entity_id = %d AND ",$user -> uid);
for($i = 1; $i < 8 ;$i++) {

}
}

function duhoc_chart_sum_contract() {
  $query = db_query("SELECT COUNT(contract.field_student_contract_value) FROM field_data_field_student_contract contract INNER JOIN node n ON contract.entity_id = n.nd WHERE FROM_UNIXTIME(n.created,'%c') = 1");
  return $query;
}